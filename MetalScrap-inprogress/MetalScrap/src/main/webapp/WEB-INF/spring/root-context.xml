<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc 
					http://www.springframework.org/schema/mvc/spring-mvc.xsd
					http://www.springframework.org/schema/tx					
					http://www.springframework.org/schema/tx/spring-tx.xsd
					http://www.springframework.org/schema/context 
					http://www.springframework.org/schema/context/spring-context.xsd
					http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
					http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd	
						">
	
	<!-- DispatcherServlet Context: defines this servlet's request-processing infrastructure -->
	
	<!-- Enables the Spring MVC @Controller programming model -->
	<mvc:annotation-driven />

	<!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
	<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/secured/" />
		<property name="suffix" value=".zul" />
	</bean>
	
	
	<context:component-scan base-package="pl.krzaq.metalscrap"></context:component-scan>
	<context:annotation-config/>
	<mvc:annotation-driven/>

	
	<mvc:resources mapping="/resources/**" location="/, classpath:/resources/" />
	
	<!-- <import resource="/appServlet/servlet-context.xml"/> -->
	
	<bean id="applicationProperties" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
   		 <property name="location" value="classpath:app.properties"/>
   		 
	</bean>
	
	<jee:jndi-lookup id="dataSource" jndi-name="java:/jboss/datasources/MySQLDS"/>
	
	 
	<!-- <bean name="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"> -->
   		 <!-- <property name="driverClassName" value="com.mysql.jdbc.Driver" />
   		 <property name="url" value="${jdbc.url}" />
  		 <property name="username" value="${jdbc.user}" />
  	   	 <property name="password" value="${jdbc.pass}" /> -->
  	   	 <!-- <property name="jndiName" value="java&#58;jboss/datasources/MysqlDS"/>
	</bean> -->
	
	
 
    <bean id="sessionFactory"
        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="configLocation">
            <value>classpath:hibernate.cfg.xml</value>
        </property>
        <property name="annotatedPackages">
            <value>pl.krzaq.metalscrap.model</value>
        </property>
        
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.MySQLDialect</prop>
                <prop key="hibernate.show_sql">false</prop>
                <prop key="hibernate.hbm2ddl.auto">update</prop>
                
                
            </props>
        </property>
    </bean>
	
	<bean id="savedRequestAwareHandler" class="pl.krzaq.metalscrap.security.CustomAuthenticationRequestHandler">
	    <property name="defaultTargetUrl" value="/app/home"></property>
	</bean>

    <bean id="transactionManager"
        class="org.springframework.orm.hibernate4.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactory" />
        <property name="dataSource" ref="dataSource" />
    </bean>

	<bean name="propertyDAO" class="pl.krzaq.metalscrap.dao.PropertyDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean name="langLabelDAO" class="pl.krzaq.metalscrap.dao.LangLabelDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	<bean name="userOfferDAO" class="pl.krzaq.metalscrap.dao.UserOfferDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean name="attachementFileDAO" class="pl.krzaq.metalscrap.dao.AttachementFileDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean name="userDAO" class="pl.krzaq.metalscrap.dao.UserDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="commodityTypeDAO" class="pl.krzaq.metalscrap.dao.CommodityTypeDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="companyDAO" class="pl.krzaq.metalscrap.dao.CompanyDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="auctionDAO" class="pl.krzaq.metalscrap.dao.AuctionDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="configDAO" class="pl.krzaq.metalscrap.dao.ConfigDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="paymentMethodDAO" class="pl.krzaq.metalscrap.dao.PaymentMethodDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="deliveryTypeDAO" class="pl.krzaq.metalscrap.dao.DeliveryTypeDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="roleDAO" class="pl.krzaq.metalscrap.dao.RoleDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="addressDAO" class="pl.krzaq.metalscrap.dao.AddressDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="categoryDAO" class="pl.krzaq.metalscrap.dao.CategoryDAO">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
	
	<bean name="mailService" class="pl.krzaq.metalscrap.service.impl.MailServiceImpl">
		<property name="mailSender" ref="mailSender"/>
	</bean>
	
	<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
  		<property name="host" value="${mail.smtp.server}"/>
	        <property name="port" value="${mail.smtp.port}"/>
	        <property name="username" value="${mail.smtp.account}"/>
	        <property name="password" value="${mail.smtp.password}"/>
	        <property name="javaMailProperties">
        <!-- additional properties specific to JavaMail -->
        <props>
            <prop key="mail.transport.protocol">${mail.transport.protocol}</prop>
            <prop key="mail.smtp.auth">${mail.smtp.auth}</prop>
            <prop key="mail.smtp.starttls.enable">${mail.smtp.starttls.enable}</prop>
        </props>
    </property>
	</bean>
	

	<bean name="propertyService" class="pl.krzaq.metalscrap.service.impl.PropertyServiceImpl">
		<property name="propertyDAO" ref="propertyDAO" />
	</bean>
	
	<bean name="langLabelService" class="pl.krzaq.metalscrap.service.impl.LangLabelServiceImpl">
		<property name="langLabelDAO" ref="langLabelDAO" />
	</bean>
	
	<bean name="userOfferService" class="pl.krzaq.metalscrap.service.impl.UserOfferServiceImpl">
		<property name="userOfferDAO" ref="userOfferDAO" />
	</bean>
	
	<bean name="attachementFileService" class="pl.krzaq.metalscrap.service.impl.AttachementFileServiceImpl">
		<property name="attachementFileDAO" ref="attachementFileDAO" />
	</bean>
		
	<bean name="categoryService" class="pl.krzaq.metalscrap.service.impl.CategoryServiceImpl">
		<property name="categoryDAO" ref="categoryDAO" />
	</bean>	
		
	<bean name="userService" class="pl.krzaq.metalscrap.service.impl.UserServiceImpl">
		<property name="userDAO" ref="userDAO" />
	</bean>
	
	<bean name="paymentMethodService" class="pl.krzaq.metalscrap.service.impl.PaymentMethodServiceImpl">
		<property name="paymentMethodDAO" ref="paymentMethodDAO" />
	</bean>
	
	<bean name="deliveryTypeService" class="pl.krzaq.metalscrap.service.impl.DeliveryTypeServiceImpl">
		<property name="deliveryTypeDAO" ref="deliveryTypeDAO" />
	</bean>
	
	<bean name="commodityTypeService" class="pl.krzaq.metalscrap.service.impl.CommodityTypeServiceImpl">
		<property name="commodityTypeDAO" ref="commodityTypeDAO" />
	</bean>
	
	<bean name="DBUserService" class="pl.krzaq.metalscrap.service.impl.DBUserServiceImpl">
		<property name="userService" ref="userService" />
	</bean>
	
	<bean name="configService" class="pl.krzaq.metalscrap.service.impl.ConfigServiceImpl">
		<property name="configDAO" ref="configDAO" />
	</bean>

	<bean name="restLoginService" class="pl.krzaq.metalscrap.service.impl.RESTLoginServiceImpl">
	
	</bean>
	
	<bean name="auctionService" class="pl.krzaq.metalscrap.service.impl.AuctionServiceImpl">
		<property name="auctionDAO" ref="auctionDAO"></property>
	</bean>
	
	<bean name="applicationContextProvider" class="pl.krzaq.metalscrap.utils.ApplicationContextProvider" >
	</bean>
	
	<bean name="services" class="pl.krzaq.metalscrap.service.impl.ServicesImpl">
		<property name="userService" ref="userService"/>
		<property name="auctionService" ref="auctionService"/>
		<property name="paymentMethodService" ref="paymentMethodService"/>
		<property name="deliveryTypeService" ref="deliveryTypeService"/>
		<property name="commodityTypeService" ref="commodityTypeService"/>
		<property name="configService" ref="configService"/>
		<property name="categoryService" ref="categoryService"/>
		<property name="attachementFileService" ref="attachementFileService"/>
		<property name="userOfferService" ref="userOfferService" />
		<property name="langLabelService" ref="langLabelService" />
		<property name="mailService" ref="mailService"></property>
		<property name="propertyService" ref="propertyService" />
	</bean>
	
	<bean id="langEvents" class="pl.krzaq.metalscrap.events.LangEvents"></bean>
	<bean id="formEvents" class="pl.krzaq.metalscrap.events.FormEvents"></bean>
	<bean id="categoryEvents" class="pl.krzaq.metalscrap.events.CategoryEvents"></bean>
	<bean id="configEvents" class="pl.krzaq.metalscrap.events.ConfigEvents"></bean>
 	<bean id="pageEvents" class="pl.krzaq.metalscrap.events.PageEvents"></bean>
 	<bean id="auctionEvents" class="pl.krzaq.metalscrap.events.AuctionEvents">
 		<property name="auctionDAO" ref="auctionDAO"/>
 		<property name="paymentMethodDAO" ref="paymentMethodDAO"/>
 		<property name="deliveryTypeDAO" ref="deliveryTypeDAO"/>
 		<property name="companyDAO" ref="companyDAO" />
 		<property name="addressDAO" ref="addressDAO" />
 		<property name="userDAO" ref="userDAO" />
 		<property name="roleDAO" ref="roleDAO" />
 		
 	</bean>
 	 	
 	<bean name="checkStartedAuctions" class="pl.krzaq.metalscrap.quartz.jobs.CheckStartedAuctions" >
 		<property name="auctionDAO" ref="auctionDAO" />
 	</bean>
 	
 	<bean name="auctionStartJob" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
 
 	<property name="durability" value="true" />
	<property name="jobClass" value="pl.krzaq.metalscrap.quartz.AuctionStartJob" />
 
	<property name="jobDataAsMap">
		<map>
			<entry key="checkStartedAuctions" value-ref="checkStartedAuctions" />
		</map>
	</property>
	</bean>
	
	
	<bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
 
		<property name="jobDetail" ref="auctionStartJob"></property>
		<property name="cronExpression" value="0/1 * * * * ?"></property>
 
	</bean>
	
	
	<bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
	<property name="jobDetails">
	   <list>
	      <ref bean="auctionStartJob" />
	   </list>
	</property>
 
	<property name="triggers">
	    <list>
		<ref bean="cronTrigger" />
	    </list>
	</property>
   </bean>
	
	
	
 	<tx:annotation-driven/>
		
</beans>
